const web3 = require('../../web3');
const ABI = require('../constants/abis');

class PlayerService {
    
    async getPlayerInfo(address) {
        const contract = new web3.eth.Contract(ABI.player_abi, address)

        return await contract.methods.player().call()
        .then(response => {
            return response;
        })
        .catch(error => {
            throw error;
        })
    }

    async getPlayers() {
        const registry = new web3.eth.Contract(ABI.registry_abi, "0xCE2BbAdD80BD398d0aB91B6927466AcbbAFa868d")
        
        return await registry.methods.getPlayersForAddress(web3.eth.defaultAccount).call()
        .then(response => {
            return response;
        })
        .catch(error => {
            throw error;
        })
    }

    async createPlayer(player, player_price) {

        const contract = new web3.eth.Contract(ABI.player_abi, null, {
            gas: 3000000
        })

        return await contract.deploy({
            data: '608060405273ce2bbadd80bd398d0ab91b6927466acbbafa868d6000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550604051620011923803806200119283398181016040526060811015620000df57600080fd5b81019080805160405193929190846401000000008211156200010057600080fd5b838201915060208201858111156200011757600080fd5b82518660018202830111640100000000821117156200013557600080fd5b8083526020830192505050908051906020019080838360005b838110156200016b5780820151818401526020810190506200014e565b50505050905090810190601f168015620001995780820380516001836020036101000a031916815260200191505b5060405260200180519060200190929190805190602001909291905050503481662386f26fc1000081028210156200021d576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260238152602001806200116f6023913960400191505060405180910390fd5b846002600001908051906020019062000238929190620003c9565b50836002600101819055508260028001819055506000600260030160006101000a81548160ff02191690831515021790555033600260030160016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503073ffffffffffffffffffffffffffffffffffffffff1631600260040181905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166302a5452133306040518363ffffffff1660e01b8152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200192505050600060405180830381600087803b158015620003a557600080fd5b505af1158015620003ba573d6000803e3d6000fd5b50505050505050505062000478565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200040c57805160ff19168380011785556200043d565b828001600101855582156200043d579182015b828111156200043c5782518255916020019190600101906200041f565b5b5090506200044c919062000450565b5090565b6200047591905b808211156200047157600081600090555060010162000457565b5090565b90565b610ce780620004886000396000f3fe60806040526004361061003f5760003560e01c806348db5f891461004457806349f22cd8146101275780637348c0c014610131578063f2f9379014610148575b600080fd5b34801561005057600080fd5b5061005961015f565b6040518080602001878152602001868152602001851515151581526020018473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001838152602001828103825288818151815260200191508051906020019080838360005b838110156100e75780820151818401526020810190506100cc565b50505050905090810190601f1680156101145780820380516001836020036101000a031916815260200191505b5097505050505050505060405180910390f35b61012f61024e565b005b34801561013d57600080fd5b50610146610657565b005b34801561015457600080fd5b5061015d610971565b005b6002806000018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101f95780601f106101ce576101008083540402835291602001916101f9565b820191906000526020600020905b8154815290600101906020018083116101dc57829003601f168201915b5050505050908060010154908060020154908060030160009054906101000a900460ff16908060030160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060040154905086565b338073ffffffffffffffffffffffffffffffffffffffff16600260030160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161415610316576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601a8152602001807f596f7520646f206e6f74206f776e207468697320706c6179657200000000000081525060200191505060405180910390fd5b60011515600260030160009054906101000a900460ff161515146103a2576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260188152602001807f54686520706c61796572206973206e6f74206c6973746564000000000000000081525060200191505060405180910390fd5b3460026004015481101561041e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260208152602001807f496e73756666696369656e742066756e647320746f2062757920706c6179657281525060200191505060405180910390fd5b600260030160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc60023073ffffffffffffffffffffffffffffffffffffffff16318161047e57fe5b049081150290604051600060405180830381858888f193505050501580156104aa573d6000803e3d6000fd5b50600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fd014d59600260030160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1633306040518463ffffffff1660e01b8152600401808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019350505050600060405180830381600087803b1580156105d957600080fd5b505af11580156105ed573d6000803e3d6000fd5b5050505033600260030160016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000600260030160006101000a81548160ff0219169083151502179055505050565b338073ffffffffffffffffffffffffffffffffffffffff16600260030160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161461071e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807f596f7520616c7265616479206f776e207468697320706c61796572000000000081525060200191505060405180910390fd5b60011515600260030160009054906101000a900460ff161515146107aa576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260188152602001807f54686520706c61796572206973206e6f74206c6973746564000000000000000081525060200191505060405180910390fd5b6000600260030160006101000a81548160ff021916908315150217905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166328b0e4cc306040518263ffffffff1660e01b8152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050600060405180830381600087803b15801561086957600080fd5b505af115801561087d573d6000803e3d6000fd5b50505050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16638e3d63c633306040518363ffffffff1660e01b8152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200192505050600060405180830381600087803b15801561095657600080fd5b505af115801561096a573d6000803e3d6000fd5b5050505050565b338073ffffffffffffffffffffffffffffffffffffffff16600260030160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610a38576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807f596f7520616c7265616479206f776e207468697320706c61796572000000000081525060200191505060405180910390fd5b60001515600260030160009054906101000a900460ff16151514610ac4576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601c8152602001807f54686520706c6179657220697320616c7265616479206c69737465640000000081525060200191505060405180910390fd5b6001600260030160006101000a81548160ff021916908315150217905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d07c8575306040518263ffffffff1660e01b8152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050600060405180830381600087803b158015610b8357600080fd5b505af1158015610b97573d6000803e3d6000fd5b50505050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663f4987b7533306040518363ffffffff1660e01b8152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200192505050600060405180830381600087803b158015610c7057600080fd5b505af1158015610c84573d6000803e3d6000fd5b505050505056fea265627a7a723158203d0089b4d6d3c9100158da1b79b07387b3abd7f0295cd9009ce2aa92fb17ac2b64736f6c637829302e352e31332d6e696768746c792e323031392e31302e32332b636f6d6d69742e65353664316161350059496e73756666696369656e742066756e647320746f2063726561746520706c61796572',
            arguments: [player.name, player.pos, player.overall]
        })
        .send({
            from: web3.eth.defaultAccount,
            value: player_price
        })
        .then((response) => {
            return response;
        })
        .catch(error => {
            throw error;
        })
    }
}

module.exports = new PlayerService()